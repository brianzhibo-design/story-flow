# StoryFlow - AI è§†é¢‘åˆ›ä½œå¹³å°

StoryFlow æ˜¯ä¸€ä¸ªä¼ä¸šçº§ AI è§†é¢‘åˆ›ä½œå¹³å°ï¼Œæ”¯æŒä»æ•…äº‹æ–‡æœ¬è‡ªåŠ¨ç”Ÿæˆåˆ†é•œã€å›¾ç‰‡å’Œè§†é¢‘ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ¬ **æ™ºèƒ½åˆ†é•œ**: è‡ªåŠ¨å°†æ•…äº‹æ–‡æœ¬æ‹†åˆ†ä¸ºåˆ†é•œè„šæœ¬
- ğŸ¨ **è§’è‰²ä¸€è‡´æ€§**: åŸºäºä¸€è‡´æ€§é”šç‚¹ä¿æŒè§’è‰²å¤–è§‚ç¨³å®š
- ğŸ–¼ï¸ **ä¸“ä¸šçº§ç”»è´¨**: é¢éƒ¨ä¿®å¤ã€æ‰‹éƒ¨ä¿®å¤ã€è¶…åˆ†è¾¨ç‡
- ğŸ›ï¸ **ControlNet**: OpenPose éª¨æ¶æ§åˆ¶è§£å†³åŒäººäº’åŠ¨ç©¿æ¨¡
- âœï¸ **Inpainting**: å±€éƒ¨ä¿®æ”¹è¡¨æƒ…ã€è§†çº¿ã€æ–‡å­—
- ğŸ¥ **è§†é¢‘åˆæˆ**: FFmpeg è‡ªåŠ¨åˆæˆå¸¦é…éŸ³çš„å®Œæ•´è§†é¢‘

## æŠ€æœ¯æ ˆ

### åç«¯
- **æ¡†æ¶**: FastAPI 0.104+
- **æ•°æ®åº“**: PostgreSQL 15 + SQLAlchemy 2.0 (async)
- **ç¼“å­˜**: Redis 7
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery + RabbitMQ
- **å¯¹è±¡å­˜å‚¨**: MinIO

### AI é›†æˆ
- DeepSeek (æ–‡æœ¬ç”Ÿæˆ)
- ComfyUI (å›¾ç‰‡ç”Ÿæˆ + ControlNet)
- å³æ¢¦ Jimeng (å›¾ç‰‡ç”Ÿæˆ)
- å¯çµ Kling (è§†é¢‘ç”Ÿæˆ)
- ç«å±±å¼•æ“ TTS (è¯­éŸ³åˆæˆ)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä¸€é”®å¯åŠ¨è„šæœ¬

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x start-dev.sh check-status.sh test-api.sh

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
./start-dev.sh

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./check-status.sh

# æµ‹è¯• API
./test-api.sh
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# å¯åŠ¨åŸºç¡€æœåŠ¡ (PostgreSQL, Redis, RabbitMQ, MinIO)
cd infrastructure/docker && docker-compose up -d

# å®‰è£… Python ä¾èµ–
cd backend
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# è¿è¡Œæ•°æ®åº“è¿ç§»
alembic upgrade head

# å¯åŠ¨åç«¯æœåŠ¡
uvicorn app.main:app --reload --port 8000
```

### æ–¹å¼ä¸‰ï¼šMake å‘½ä»¤

```bash
make dev-up    # å¯åŠ¨å¼€å‘ç¯å¢ƒ
make install   # å®‰è£…ä¾èµ–
make migrate   # æ•°æ®åº“è¿ç§»
make run       # å¯åŠ¨åç«¯
```

### 2. æœåŠ¡ç«¯å£

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| FastAPI | 8000 | åç«¯ API |
| PostgreSQL | 5432 | æ•°æ®åº“ |
| Redis | 6379 | ç¼“å­˜ |
| RabbitMQ | 5672/15672 | æ¶ˆæ¯é˜Ÿåˆ—/ç®¡ç†ç•Œé¢ |
| MinIO | 9000/9001 | å¯¹è±¡å­˜å‚¨/æ§åˆ¶å° |

### 3. å¸¸ç”¨å‘½ä»¤

```bash
make help       # æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
make dev-up     # å¯åŠ¨å¼€å‘ç¯å¢ƒ
make dev-down   # åœæ­¢å¼€å‘ç¯å¢ƒ
make run        # å¯åŠ¨åç«¯
make test       # è¿è¡Œæµ‹è¯•
make lint       # ä»£ç æ£€æŸ¥
make format     # ä»£ç æ ¼å¼åŒ–
```

## é¡¹ç›®ç»“æ„

```
storyflow/
â”œâ”€â”€ backend/           # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/           # åº”ç”¨ä»£ç 
â”‚   â”‚   â”œâ”€â”€ api/       # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ models/    # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas/   # Pydantic æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ services/  # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ workers/   # Celery ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ ai_gateway/# AI ç½‘å…³
â”‚   â”‚   â”œâ”€â”€ core/      # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â””â”€â”€ middleware/# ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ migrations/    # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ tests/         # æµ‹è¯•
â”œâ”€â”€ frontend/          # å‰ç«¯ (Vue3)
â”œâ”€â”€ infrastructure/    # åŸºç¡€è®¾æ–½é…ç½®
â”œâ”€â”€ docs/              # æ–‡æ¡£
â””â”€â”€ scripts/           # è„šæœ¬
```

## ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶é…ç½®ç›¸å…³å˜é‡ï¼š

```bash
cp .env.example .env
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
cd backend
source venv/bin/activate

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# å¸¦è¦†ç›–ç‡
pytest tests/ -v --cov=app --cov-report=html
```

### API æµ‹è¯•è„šæœ¬

```bash
./test-api.sh
```

## ğŸ“Š ä¸“ä¸šçº§åŠŸèƒ½ (åŸºäºçŸ­å‰§åˆ›ä½œå®æˆ˜)

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| è§’è‰²ä¸€è‡´æ€§é”šç‚¹ | æ¯ä¸ªè§’è‰²æœ‰å”¯ä¸€"èº«ä»½è¯"æè¿° |
| ä¸‰ç»´åº¦æç¤ºè¯ | è§’è‰² + åœºæ™¯ + ç‰©å“ åˆ†ç¦»æ„å»º |
| å…‰ç…§ç»Ÿä¸€æ€§ | è‡ªåŠ¨æ£€æŸ¥å…‰æºæ–¹å‘ä¸€è‡´ |
| æ—¶ä»£é€»è¾‘æ ¡éªŒ | é˜²æ­¢å‡ºç°æ—¶ä»£é”™ä¹± |
| é•œå¤´è¿åŠ¨å®‰å…¨ | ç‰¹å†™é•œå¤´è‡ªåŠ¨é™ä½è¿åŠ¨å¼ºåº¦ |
| ç”»è´¨å¢å¼º | è‡ªåŠ¨é¢éƒ¨/æ‰‹éƒ¨ä¿®å¤ + è¶…åˆ† |
| OpenPose åŒäººäº’åŠ¨ | è§£å†³è‚¢ä½“ç©¿æ¨¡é—®é¢˜ |

## License

MIT

